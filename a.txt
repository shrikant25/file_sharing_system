#include <stdio.h>
#include <stdlib.h>
#include <libpq-fe.h>

int main() {
    // Connect to the database
    PGconn* conn = PQconnectdb("host=localhost port=5432 dbname=mydb user=myuser password=mypassword");
    if (PQstatus(conn) != CONNECTION_OK) {
        printf("Error connecting to the database: %s\n", PQerrorMessage(conn));
        return 1;
    }

    // Prepare the SQL statement
    const char* sql = "INSERT INTO mytable (file_data) VALUES (pg_read_binary_file($1))";
    PGresult* res = PQprepare(conn, "insert_binary", sql, 1, NULL);
    if (PQresultStatus(res) != PGRES_COMMAND_OK) {
        printf("Error preparing SQL statement: %s\n", PQresultErrorMessage(res));
        PQclear(res);
        PQfinish(conn);
        return 1;
    }
    PQclear(res);

    // Bind the file path to the statement
    const char* file_path = "file.bin";
    int param_formats[1] = {0};
    int param_lengths[1] = {strlen(file_path)};
    const char* param_values[1] = {file_path};
    res = PQexecPrepared(conn, "insert_binary", 1, param_values, param_lengths, param_formats, 1);
    if (PQresultStatus(res) != PGRES_COMMAND_OK) {
        printf("Error executing SQL statement: %s\n", PQresultErrorMessage(res));
        PQclear(res);
        PQfinish(conn);
        return 1;
    }
    PQclear(res);

    // Close the connection
    PQfinish(conn);
    return 0;
}

